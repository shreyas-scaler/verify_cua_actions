<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gemini Action Verifier</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: monospace; background: #111827; color: #e5e7eb; overflow: hidden; width: 1280px; height: 960px; position: relative; }

  #hud {
    position: absolute; top: 4px; left: 4px; right: 4px;
    background: rgba(0,0,0,0.7); border: 1px solid #374151; border-radius: 4px;
    padding: 4px 8px; font-size: 10px; z-index: 100; display: flex; gap: 12px; align-items: center;
  }
  #hud .pass { color: #22c55e; }
  #hud .pending { color: #6b7280; }
  #hud #mouse-pos { margin-left: auto; color: #4b5563; }

  .target {
    position: absolute; border-radius: 2px;
    display: flex; align-items: center; justify-content: center;
    font-size: 7px; font-weight: 700; letter-spacing: 0.03em;
    user-select: none; cursor: default;
    transition: outline-color 0.15s;
    outline: 1px solid transparent;
  }
  .target.hit { outline-color: #22c55e; background: rgba(34,197,94,0.2) !important; }

  .label {
    position: absolute; font-size: 8px; color: #4b5563;
    white-space: nowrap; pointer-events: none;
  }

  #input-type {
    position: absolute; width: 80px; height: 14px; padding: 0 2px;
    border: 1px solid #4b5563; background: #1f2937; color: #e5e7eb;
    font-size: 9px; font-family: monospace; outline: none; border-radius: 1px;
  }
  #input-type:focus { border-color: #60a5fa; }
  #input-type.hit { border-color: #22c55e; }

  .key-target {
    position: absolute; width: 40px; height: 14px;
    border: 1px solid #4b5563; background: #1f2937; border-radius: 1px;
    font-size: 7px; color: #6b7280; display: flex; align-items: center;
    justify-content: center; outline: none; cursor: default;
  }
  .key-target:focus { border-color: #60a5fa; color: #e5e7eb; }
  .key-target.hit { border-color: #22c55e; background: rgba(34,197,94,0.15); }

  #scroll-zone {
    position: absolute; width: 60px; height: 40px; overflow: auto;
    border: 1px solid #4b5563; background: #0f172a; border-radius: 1px;
  }
  #scroll-zone.hit { border-color: #22c55e; }
  #scroll-zone .inner { height: 300px; padding: 2px; font-size: 7px; color: #4b5563; }

  .drag-src {
    position: absolute; width: 16px; height: 16px; background: #3b82f6;
    border-radius: 2px; cursor: grab; font-size: 7px; color: #fff;
    display: flex; align-items: center; justify-content: center;
  }
  .drag-dest {
    position: absolute; width: 20px; height: 20px; border: 1px dashed #22c55e;
    border-radius: 2px; font-size: 6px; color: #22c55e;
    display: flex; align-items: center; justify-content: center;
  }
  .drag-dest.hit { background: rgba(34,197,94,0.2); }

  #btn-pushstate {
    position: absolute; width: 40px; height: 14px; cursor: pointer;
    border: 1px solid #4b5563; background: #1f2937; border-radius: 1px;
    font-size: 7px; color: #6b7280; display: flex; align-items: center;
    justify-content: center;
  }
  #btn-pushstate.hit { border-color: #22c55e; color: #22c55e; }

  #event-log {
    position: absolute; bottom: 4px; left: 4px; right: 4px; height: 80px;
    background: rgba(0,0,0,0.7); border: 1px solid #374151; border-radius: 4px;
    padding: 4px 6px; font-size: 9px; overflow-y: auto; z-index: 100;
  }
  #event-log .e { margin-bottom: 1px; }
  #event-log .ts { color: #4b5563; }
  #event-log .act { color: #60a5fa; }
  #event-log .det { color: #d1d5db; }
  #event-log .coord { color: #fbbf24; }
</style>
</head>
<body>

<div id="hud">
  <span>GEMINI ACTION VERIFIER</span>
  <span>| <span class="pass" id="hud-pass">0</span> pass</span>
  <span><span class="pending" id="hud-pending">0</span> pending</span>
  <span id="mouse-pos">x:- y:-</span>
</div>

<!--
  Gemini supported actions:
  click_at, hover_at, type_text_at, key_combination,
  scroll_at, scroll_document, drag_and_drop,
  navigate, go_back, go_forward, search,
  wait_5_seconds, open_web_browser
-->

<!-- 1. click_at: 16x16 at (200, 150) => center (208, 158) -->
<div class="target" id="t-click" style="left:200px;top:150px;width:16px;height:16px;background:#2563eb;">C</div>
<div class="label" style="left:220px;top:150px;">Step 1 Click</div>

<!-- 2. hover_at: 16x16 at (200, 200) => center (208, 208) -->
<div class="target" id="t-hover" style="left:200px;top:200px;width:16px;height:16px;background:#0891b2;">H</div>
<div class="label" style="left:220px;top:200px;">Step 2 Hover</div>

<!-- 3. type_text_at: input at (500, 150) -->
<input id="input-type" style="left:500px;top:150px;" placeholder="type here" />
<div class="label" style="left:585px;top:150px;">Step 3 Type</div>

<!-- 4. key_combination: key zone at (500, 200) -->
<div class="key-target" id="t-keycomb" tabindex="0" style="left:500px;top:200px;">keys</div>
<div class="label" style="left:545px;top:200px;">Step 4 Key combination</div>

<!-- 5. scroll_at: small scrollable at (200, 280) -->
<div id="scroll-zone" style="left:200px;top:280px;">
  <div class="inner">
    S1<br>S2<br>S3<br>S4<br>S5<br>S6<br>S7<br>S8<br>
    S9<br>S10<br>S11<br>S12<br>S13<br>S14<br>S15<br>END
  </div>
</div>
<div class="label" style="left:265px;top:280px;">Step 5 scroll</div>

<!-- 6. scroll_document: verified via body scroll listener -->
<div class="target" id="t-scrolldoc" style="left:200px;top:350px;width:16px;height:16px;background:#6d28d9;">P</div>
<div class="label" style="left:220px;top:350px;">Step 6 scroll doc</div>

<!-- 7. drag_and_drop: source 16x16 at (500, 280), dest 20x20 at (620, 280) -->
<div class="drag-src" id="drag-src" style="left:500px;top:280px;">D</div>
<div class="drag-dest" id="drag-dest" style="left:620px;top:280px;">T</div>
<div class="label" style="left:500px;top:270px;">Step 7 drag and drop</div>

<!-- 8. navigate: click triggers simulated nav -->
<div class="target" id="t-navigate" style="left:800px;top:150px;width:16px;height:16px;background:#065f46;">N</div>
<div class="label" style="left:820px;top:150px;">Step 8 navigate</div>

<!-- 9. go_back / go_forward -->
<div id="btn-pushstate" style="left:800px;top:200px;">push</div>
<div class="label" style="left:845px;top:200px;">Step 9 go_back/fwd</div>


<div id="event-log"></div>

<script>
  const verified = {};
  const ALL_TESTS = [
    'click','hover','type','keycomb','scroll','scrolldoc',
    'drag','navigate','backfwd'
  ];

  function ts() { return new Date().toISOString().split('T')[1].slice(0,12); }

  function logEvent(action, detail) {
    const el = document.getElementById('event-log');
    const d = document.createElement('div');
    d.className = 'e';
    d.innerHTML = `<span class="ts">${ts()}</span> <span class="act">[${action}]</span> <span class="det">${detail}</span>`;
    el.prepend(d);
  }

  function markPass(testId, el) {
    if (!verified[testId]) {
      verified[testId] = true;
      if (el) el.classList.add('hit');
      updateHud();
    }
  }

  function updateHud() {
    const pass = Object.keys(verified).length;
    document.getElementById('hud-pass').textContent = pass;
    document.getElementById('hud-pending').textContent = ALL_TESTS.length - pass;
  }
  updateHud();

  document.addEventListener('mousemove', (e) => {
    document.getElementById('mouse-pos').textContent = `x:${e.clientX} y:${e.clientY}`;
  });

  // 1. click_at
  document.getElementById('t-click').addEventListener('click', (e) => {
    logEvent('click_at', `click at <span class="coord">(${e.clientX},${e.clientY})</span>`);
    markPass('click', e.currentTarget);
  });

  // 2. hover_at
  document.getElementById('t-hover').addEventListener('mouseenter', (e) => {
    logEvent('hover_at', `mouseenter at <span class="coord">(${e.clientX},${e.clientY})</span>`);
    markPass('hover', e.currentTarget);
  });

  // 3. type_text_at
  const inp = document.getElementById('input-type');
  inp.addEventListener('input', () => {
    logEvent('type_text_at', `value="${inp.value}"`);
    markPass('type', inp);
  });

  // 4. key_combination
  const tKey = document.getElementById('t-keycomb');
  tKey.addEventListener('keydown', (e) => {
    const parts = [];
    if (e.ctrlKey) parts.push('Ctrl');
    if (e.altKey) parts.push('Alt');
    if (e.shiftKey) parts.push('Shift');
    parts.push(e.key);
    logEvent('key_combination', `${parts.join('+')} (code:${e.code})`);
    markPass('keycomb', tKey);
  });

  // 5. scroll_at
  const scrollZone = document.getElementById('scroll-zone');
  scrollZone.addEventListener('scroll', () => {
    logEvent('scroll_at', `scrollTop=${Math.round(scrollZone.scrollTop)}`);
    markPass('scroll', scrollZone);
  });

  // 6. scroll_document (PageDown/PageUp key press detected at document level)
  document.addEventListener('keydown', (e) => {
    if (e.key === 'PageDown' || e.key === 'PageUp') {
      logEvent('scroll_document', `${e.key} pressed`);
      markPass('scrolldoc', document.getElementById('t-scrolldoc'));
    }
  });

  // 7. drag_and_drop
  const dragSrc = document.getElementById('drag-src');
  const dragDest = document.getElementById('drag-dest');
  let isDragging = false, dox = 0, doy = 0;

  dragSrc.addEventListener('mousedown', (e) => {
    isDragging = true;
    const r = dragSrc.getBoundingClientRect();
    dox = e.clientX - r.left;
    doy = e.clientY - r.top;
    logEvent('drag_and_drop', `start at <span class="coord">(${e.clientX},${e.clientY})</span>`);
    e.preventDefault();
  });
  document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    dragSrc.style.left = (e.clientX - dox) + 'px';
    dragSrc.style.top = (e.clientY - doy) + 'px';
  });
  document.addEventListener('mouseup', (e) => {
    if (!isDragging) return;
    isDragging = false;
    logEvent('drag_and_drop', `end at <span class="coord">(${e.clientX},${e.clientY})</span>`);
    const dr = dragDest.getBoundingClientRect();
    if (e.clientX >= dr.left && e.clientX <= dr.right && e.clientY >= dr.top && e.clientY <= dr.bottom) {
      markPass('drag', dragDest);
      logEvent('drag_and_drop', 'dropped on target!');
    }
  });

  // 8. navigate
  document.getElementById('t-navigate').addEventListener('click', (e) => {
    logEvent('navigate', `click at <span class="coord">(${e.clientX},${e.clientY})</span> (nav would leave page)`);
    markPass('navigate', e.currentTarget);
  });

  // 9. go_back / go_forward
  let histIdx = 0;
  document.getElementById('btn-pushstate').addEventListener('click', () => {
    histIdx++;
    history.pushState({ i: histIdx }, '', `?s=${histIdx}`);
    logEvent('go_back/fwd', `pushState #${histIdx}`);
  });
  window.addEventListener('popstate', (e) => {
    logEvent('go_back/fwd', `popstate: ${JSON.stringify(e.state)} url:${location.search}`);
    markPass('backfwd', document.getElementById('btn-pushstate'));
  });

</script>
</body>
</html>
